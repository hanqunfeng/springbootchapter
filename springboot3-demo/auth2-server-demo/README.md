# OAuth2认证模式
可以参考：https://github.com/hanqunfeng/springbootchapter/blob/master/chapter48/oauth2-authserver-demo/README.md
## 验证码模式

* 1.注意这里`scope`，多个之间用空格分隔，链接里就是 `%20`
GET http://localhost:9090/oauth2/authorize?response_type=code&client_id=client&scope=userEntity:info%20openid&redirect_uri=https://www.baidu.com

```java
// 如果registeredClient做了如下设置，则用户登录后需要确认授权，但是OidcScopes中定义的scope是不需要确认的
registeredClient.clientSettings(ClientSettings.builder()
                .requireAuthorizationConsent(true)  // 登录时要求用户确认授权，默认为false
                .build());
```

浏览器打开上面的连接后会要求登录并确认`scope`，如果认证通过，会重定向到如下地址，获取`code`
https://www.baidu.com/?code=mhUUF952HXqCZUqlfwxyUhW5wh11HMyXfVml59XzwMwT80QHudtxDoNvmtwE1MJ2JG99v_jb01Ne5rpEDVZ3b4kHraEeqC4Erxnqf73lM9KUcShHSTx0diDYX9yNQ_Rc

code: mhUUF952HXqCZUqlfwxyUhW5wh11HMyXfVml59XzwMwT80QHudtxDoNvmtwE1MJ2JG99v_jb01Ne5rpEDVZ3b4kHraEeqC4Erxnqf73lM9KUcShHSTx0diDYX9yNQ_Rc

* 2.获取`access_token`和`refresh_token`，注意上面获取的code必须在10分钟内使用，且只能使用一次
注意这里要开启 `ClientAuthenticationMethod.CLIENT_SECRET_POST`，否则`client_id`和`client_secret`不能通过参数传递
POST http://localhost:9090/oauth2/token?grant_type=authorization_code&client_id=client&client_secret=secret&redirect_uri=https://www.baidu.com&code=mhUUF952HXqCZUqlfwxyUhW5wh11HMyXfVml59XzwMwT80QHudtxDoNvmtwE1MJ2JG99v_jb01Ne5rpEDVZ3b4kHraEeqC4Erxnqf73lM9KUcShHSTx0diDYX9yNQ_Rc
响应结果：
```json
{
"access_token": "eyJraWQiOiI2MGRkZWM0Ny01YTNhLTRiZmItYTY4NS1hNDE2ZjIyNjEyM2UiLCJhbGciOiJSUzI1NiJ9.eyJzdWIiOiJhZG1pbiIsImF1ZCI6ImNsaWVudCIsIm5iZiI6MTY5Mjg0NzMyOCwic2NvcGUiOlsidXNlcjppbmZvIiwib3BlbmlkIl0sImlzcyI6Imh0dHA6Ly9sb2NhbGhvc3Q6OTA5MCIsImV4cCI6MTY5Mjg5MDUyOCwiaWF0IjoxNjkyODQ3MzI4fQ.QAre8FWXV7UY6kPv1WpT351XOfdb7nO8hld_DHZGMg4EiGnbsJZYdHYDMFZkbGxRdVYh8ENYSGc-IBS_3kT2zAffobmHfjVii6Jacs_zZNMsaniTbtP8kBhrt3Z-qbDrDhmWU13uK2FYPOGVprx8y8aNk4i5j6aLJtEcKyVuSSTuzn8sbb42X6NEXdL7_PMqQRHgjsDjGXPcNDI5JAv3cNAi0CnpQpSPiNqVB52OwfDL53HrBrVDntXnw15iQfanhuHjdJ4aTlF1qm5t_7pm03132PeWXtmJ7htk6GO7UeF8_Xpxyj1xoaQk18NzcaTtGuQpQFDs8slfUto5_l79kA",
"refresh_token": "WAL5bD8sRKQjdY3H3Io-e0E61rEgjIHyRvMJ1wVTj6HCW_3ebFy4iVyBQHxsVCn-odvCrVaPcRcv9uRZKOpXc6I3O4gtuP6c90nPYLcJj5S0QWbOBMP2pQUfgs2GPaK-",
"scope": "userEntity:info openid",
"id_token": "eyJraWQiOiI2MGRkZWM0Ny01YTNhLTRiZmItYTY4NS1hNDE2ZjIyNjEyM2UiLCJhbGciOiJSUzI1NiJ9.eyJzdWIiOiJhZG1pbiIsImF1ZCI6ImNsaWVudCIsImF6cCI6ImNsaWVudCIsImF1dGhfdGltZSI6MTY5Mjg0NzMxNSwiaXNzIjoiaHR0cDovL2xvY2FsaG9zdDo5MDkwIiwiZXhwIjoxNjkyODQ5MTI4LCJpYXQiOjE2OTI4NDczMjgsInNpZCI6IkNpakZIeEhmcjEyYWdheWE5cklQR3ppdi1QdUhuUUROSkxhTkJaczh2TXMifQ.Lyb_4UtgBajMdlhd8lwwGYzFcCCRjNHMW0QYdta8WoABYSA7jphjZBYRVDrYvwINl8kiMdJZ8-k9PhC56okicmp2ZHWeb6WKVnenhoGnmZNtDQ4SXFl9UvJzIzf4n48wNWe53jkHnnRwk2be99gmFsn6xn5_fmnZ32NX4i7789DDoQiFkulTmNE1uga-CHBY6HqksmpoCNHS1nZVxKQbP8wm0fRPWPI69vXsB7pxI7jCfGQ61aaBU5CPckVhAoBlSq8xKnglmLSkmUimIL6hmq5ffU59cmH4uUKMe00j2LG21wNweOs3JI5urhzPL3_TQD9-rAlCjoKU1lEbuw1DRQ",
"token_type": "Bearer",
"expires_in": 43199
}
```
如果配置的是`ClientAuthenticationMethod.CLIENT_SECRET_BASIC`，可以将`client_id`和`client_secret`放到url的前面
POST http://client:secret@localhost:9090/oauth2/token?grant_type=authorization_code&redirect_uri=https://www.baidu.com&code=mhUUF952HXqCZUqlfwxyUhW5wh11HMyXfVml59XzwMwT80QHudtxDoNvmtwE1MJ2JG99v_jb01Ne5rpEDVZ3b4kHraEeqC4Erxnqf73lM9KUcShHSTx0diDYX9yNQ_Rc

# refresh_token模式
* 通过`refresh_token`获取`access_token`
  `refresh_token`和`access_token`都有有效期，默认`access_token`有效期12小时，`refresh_token`有效期30天
POST http://localhost:9090/oauth2/token?grant_type=refresh_token&client_id=client&client_secret=secret&refresh_token=WAL5bD8sRKQjdY3H3Io-e0E61rEgjIHyRvMJ1wVTj6HCW_3ebFy4iVyBQHxsVCn-odvCrVaPcRcv9uRZKOpXc6I3O4gtuP6c90nPYLcJj5S0QWbOBMP2pQUfgs2GPaK-
响应结果
```json
{
    "access_token": "eyJraWQiOiI2MGRkZWM0Ny01YTNhLTRiZmItYTY4NS1hNDE2ZjIyNjEyM2UiLCJhbGciOiJSUzI1NiJ9.eyJzdWIiOiJhZG1pbiIsImF1ZCI6ImNsaWVudCIsIm5iZiI6MTY5Mjg0ODEwMywic2NvcGUiOlsidXNlcjppbmZvIiwib3BlbmlkIl0sImlzcyI6Imh0dHA6Ly9sb2NhbGhvc3Q6OTA5MCIsImV4cCI6MTY5Mjg5MTMwMywiaWF0IjoxNjkyODQ4MTAzfQ.sarc2YK-yklYETCXNDVTo95RKoGoTefEATYnbSkM0cATbMhO1-lXhJJJzqtdhchPamcyKEjxAwSoDruWmJjYuYm51DlhevdzpAZLZVO6gm35xRlVVeOvunJeZYdEEMGWndpj_S4tWjW8nqptoTLpSnBmjVFaQ2twbewNDdljfTBxDhyR9LLTB5_1dtQ2aIVbSPdjIMdiZAyUqTAXHAPNOdwTXjRLP2g9ClvWnPjnke1MAlt7C0G4YvIdI4Wtj5yhyp_rvQwF-FmR7YBAH4ILXS16oc7lQXZwr6slblQvKRPiDCRM-3E1rSLz_At2hpIao74e8RcYG8nO9iFf8hXBXQ",
    "refresh_token": "WAL5bD8sRKQjdY3H3Io-e0E61rEgjIHyRvMJ1wVTj6HCW_3ebFy4iVyBQHxsVCn-odvCrVaPcRcv9uRZKOpXc6I3O4gtuP6c90nPYLcJj5S0QWbOBMP2pQUfgs2GPaK-",
    "scope": "userEntity:info openid",
    "id_token": "eyJraWQiOiI2MGRkZWM0Ny01YTNhLTRiZmItYTY4NS1hNDE2ZjIyNjEyM2UiLCJhbGciOiJSUzI1NiJ9.eyJzdWIiOiJhZG1pbiIsImF1ZCI6ImNsaWVudCIsImF6cCI6ImNsaWVudCIsImF1dGhfdGltZSI6MTY5Mjg0NzMxNSwiaXNzIjoiaHR0cDovL2xvY2FsaG9zdDo5MDkwIiwiZXhwIjoxNjkyODQ5OTAzLCJpYXQiOjE2OTI4NDgxMDMsInNpZCI6IkNpakZIeEhmcjEyYWdheWE5cklQR3ppdi1QdUhuUUROSkxhTkJaczh2TXMifQ.NIQMb-bnQ88s3dujTu_g_5N8WOlEWoyO-yHcqcrajxegE941ShI1OIic-YH9STo1jhpwP-NtAaK4bZajMF7ChzHVfpiZ1fAcV4WTfB6mzTd6BEihQoXF4PwyhibWVKgmwIdllMyjyoUbWVJ1YkH4LRZSxNpJH6bU4IWtNGlvX4-ti7ROGtT4hKiwvl95S-pAlWGiykQ6wNDUfbQr_2SfI_nuw-4dCTo2n1DzXii-imU0dP1VCviIA6Qmyc7lcP7h1GCgiiLQN2qZr2KlnsAicLiZVEJ6bQIedb7fVdJvGd4O0acqHxW6HnTQV7P4VMqp3iAzpfsMMzYnMCmzp1lXmQ",
    "token_type": "Bearer",
    "expires_in": 43199
}
```
如果配置的是`ClientAuthenticationMethod.CLIENT_SECRET_BASIC`，可以将`client_id`和`client_secret`放到url的前面
POST http://client:secret@localhost:9090/oauth2/token?grant_type=refresh_token&refresh_token=WAL5bD8sRKQjdY3H3Io-e0E61rEgjIHyRvMJ1wVTj6HCW_3ebFy4iVyBQHxsVCn-odvCrVaPcRcv9uRZKOpXc6I3O4gtuP6c90nPYLcJj5S0QWbOBMP2pQUfgs2GPaK-
